<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OwnDC</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/app.js" defer></script>
</head>

<body>
  <!-- Notification Container -->
  <div id="notification-container" style="position:fixed;top:20px;right:20px;z-index:9999;pointer-events:none;"></div>

  <!-- Audio Elements -->
  <audio id="ringtone" preload="auto" loop>
    <!-- Use a simple reliable sound or placeholder data URI -->
    <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=" type="audio/wav">
  </audio>

  <!-- Auth Screen -->
  <div id="auth-screen" class="auth-container">
    <div class="auth-box">
      <div style="text-align:center;margin-bottom:24px;">
        <h2 style="color:var(--header-primary);margin-bottom:8px;">Welcome Back!</h2>
        <p style="color:var(--text-secondary);">We're so excited to see you again!</p>
      </div>

      <!-- Login Form -->
      <div id="login-form">
        <div style="margin-bottom:16px;">
          <label
            style="display:block;color:var(--header-secondary);font-size:12px;font-weight:700;margin-bottom:8px;text-transform:uppercase;">Username</label>
          <input id="login-username"
            style="width:100%;padding:10px;background:var(--input-bg);border:none;border-radius:3px;color:var(--text-normal);outline:none;">
        </div>
        <div style="margin-bottom:16px;">
          <label
            style="display:block;color:var(--header-secondary);font-size:12px;font-weight:700;margin-bottom:8px;text-transform:uppercase;">Password</label>
          <input id="login-password" type="password"
            style="width:100%;padding:10px;background:var(--input-bg);border:none;border-radius:3px;color:var(--text-normal);outline:none;">
        </div>
        <div id="login-error" style="color:var(--red);font-size:12px;margin-bottom:16px;"></div>
        <button id="login-btn" class="btn btn-primary" style="width:100%;margin-bottom:8px;">Log In</button>
        <div style="font-size:14px;color:var(--text-secondary);">Need an account? <span id="show-register"
            style="color:var(--text-link);cursor:pointer;">Register</span></div>
      </div>

      <!-- Register Form -->
      <div id="register-form" style="display:none;">
        <div style="margin-bottom:16px;">
          <label
            style="display:block;color:var(--header-secondary);font-size:12px;font-weight:700;margin-bottom:8px;text-transform:uppercase;">Email</label>
          <input id="reg-email" type="email"
            style="width:100%;padding:10px;background:var(--input-bg);border:none;border-radius:3px;color:var(--text-normal);outline:none;">
        </div>
        <div style="margin-bottom:16px;">
          <label
            style="display:block;color:var(--header-secondary);font-size:12px;font-weight:700;margin-bottom:8px;text-transform:uppercase;">Username</label>
          <input id="reg-username"
            style="width:100%;padding:10px;background:var(--input-bg);border:none;border-radius:3px;color:var(--text-normal);outline:none;">
        </div>
        <div style="margin-bottom:16px;">
          <label
            style="display:block;color:var(--header-secondary);font-size:12px;font-weight:700;margin-bottom:8px;text-transform:uppercase;">Password</label>
          <input id="reg-password" type="password"
            style="width:100%;padding:10px;background:var(--input-bg);border:none;border-radius:3px;color:var(--text-normal);outline:none;">
        </div>
        <div id="register-error" style="color:var(--red);font-size:12px;margin-bottom:16px;"></div>
        <button id="register-btn" class="btn btn-primary" style="width:100%;margin-bottom:8px;">Continue</button>
        <div style="font-size:14px;color:var(--text-secondary);">Already have an account? <span id="show-login"
            style="color:var(--text-link);cursor:pointer;">Log In</span></div>
      </div>
    </div>
  </div>

  <!-- Main App -->
  <div id="main-app" class="app-mount hidden">
    <!-- 1. Sidebar Servers -->
    <nav class="sidebar-servers">
      <!-- Home Button -->
      <div class="server-icon-wrapper active" id="server-home">
        <div class="server-pill"></div>
        <div class="server-icon" style="background-color:var(--brand);">
          <svg width="28" height="20" viewBox="0 0 28 20" fill="white">
            <path
              d="M23.0212 1.67671C21.3107 0.879656 19.5079 0.318797 17.6584 0C17.4062 0.461742 17.1749 0.934541 16.9708 1.4184C15.0172 1.11817 13.0924 1.11817 11.1284 1.4184C10.9192 0.934541 10.6879 0.461742 10.4357 0C8.58618 0.318797 6.78841 0.879656 5.07791 1.67671C1.61498 6.94272 0.697412 12.0494 1.16616 17.156C3.41738 18.817 5.56828 19.8252 7.64379 20C8.16912 19.2905 8.6322 18.5367 9.02705 17.7471C8.25265 17.4495 7.50973 17.086 6.80419 16.6667C6.9944 16.5273 7.17482 16.3814 7.34586 16.2235C11.647 18.1969 16.4429 18.1969 20.7139 16.2235C20.8849 16.3814 21.0704 16.5273 21.2606 16.6667C20.5551 17.086 19.8122 17.4495 19.0378 17.7471C19.4326 18.5367 19.9008 19.2905 20.4261 20C22.5016 19.8252 24.6525 18.817 26.9038 17.156C27.4939 11.751 26.2736 6.64966 23.0212 1.67671ZM9.68041 13.6383C8.39754 13.6383 7.34085 12.4456 7.34085 11.0069C7.34085 9.56816 8.35418 8.37549 9.68041 8.37549C11.0218 8.37549 12.0656 9.56816 12.0223 11.0069C12.0223 12.4456 11.0069 13.6383 9.68041 13.6383ZM18.3795 13.6383C17.0966 13.6383 16.0399 12.4456 16.0399 11.0069C16.0399 9.56816 17.0533 8.37549 18.3795 8.37549C19.7209 8.37549 20.7647 9.56816 20.7214 11.0069C20.7214 12.4456 19.7209 13.6383 18.3795 13.6383Z" />
          </svg>
        </div>
      </div>
      <div class="server-separator"></div>

      <!-- Server List Container -->
      <div id="server-list"></div>

      <!-- Add Server Button -->
      <!-- <div class="server-icon-wrapper" onclick="window.app.showAddServerModal()">
        <div class="server-pill"></div>
        <div class="server-icon" style="background-color:var(--bg-primary);color:var(--green);">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M13 11H20V13H13V20H11V13H4V11H11V4H13V11Z"/></svg>
        </div>
      </div> -->
      <!-- Public Voice Test placeholder icon -->
      <div class="server-icon-wrapper" onclick="window.app.joinPublicVoice()" title="Join Public Voice Test">
        <div class="server-pill"></div>
        <div class="server-icon" style="background-color:var(--bg-primary);color:var(--text-normal);">
          ðŸŽ¤
        </div>
      </div>
    </nav>

    <!-- 2. Sidebar Channels -->
    <div class="sidebar-channels">
      <!-- Server/Context Header -->
      <div class="channel-header" id="sidebar-header" onclick="window.app.handleHeaderClick()">
        <span class="channel-header-text" id="sidebar-header-text">Home</span>
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M16.59 8.59004L12 13.17L7.41 8.59004L6 10L12 16L18 10L16.59 8.59004Z" />
        </svg>
      </div>

      <!-- Channel List -->
      <div class="channel-list" id="channel-list">
        <!-- Dynamic Content: DMs/Channels -->
      </div>

      <!-- User Area -->
      <div class="user-area">
        <div class="user-area-info" onclick="window.app.openSettings()">
          <div class="user-avatar" id="current-user-avatar">
            <div class="user-status-dot"></div>
          </div>
          <div class="user-text">
            <div class="user-username" id="current-user-name">Username</div>
            <div class="user-subtext" id="current-user-discriminator">#0000</div>
          </div>
        </div>
        <div class="user-controls">
          <button class="control-btn" id="btn-mute" onclick="window.app.toggleMute()">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C8.7 2 6 4.7 6 8v7H4v2h16v-2h-2V8c0-3.3-2.7-6-6-6zm-3 18c0 1.7 1.3 3 3 3s3-1.3 3-3H9z" />
            </svg> <!-- Placeholder icon -->
          </button>
          <button class="control-btn" id="btn-deafen" onclick="window.app.toggleDeafen()">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M12 3a9 9 0 0 0-9 9v7c0 1.66 1.34 3 3 3h3a1 1 0 0 0 1-1v-5a1 1 0 0 0-1-1H5v-.5a7 7 0 1 1 14 0v.5h-4a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h3c1.66 0 3-1.34 3-3v-7a9 9 0 0 0-9-9z" />
            </svg>
          </button>
          <button class="control-btn" onclick="window.app.openSettings()">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.04.17 0 .36.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.58 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.04-.22 0-.45-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- 3. Main Content -->
    <div class="main-content">
      <!-- Chat Header -->
      <div class="chat-header">
        <div class="header-left">
          <div class="header-icon" id="header-icon">#</div>
          <div class="header-title" id="header-title">general</div>
          <div class="header-description" id="header-description"></div>
        </div>
        <div class="header-toolbar">
          <!-- Call Buttons for DM -->
          <div class="toolbar-icon hidden" id="btn-start-call" title="Start Voice Call"
            onclick="window.app.startCall(null, false)">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M20.01 15.38C18.78 15.01 17.37 15.19 16.31 15.91L15.48 16.74C12.38 15.22 10.39 12.87 9.17 10.22L10.02 9.38C10.75 8.32 10.92 6.91 10.55 5.68L9.77 3.03C9.52 2.18 8.64 1.69 7.76 1.88L4.31 2.65C3.32 2.87 2.5 3.96 2.83 5.09C4.33 10.23 8.35 15.79 14.18 19.16C15.6 19.97 17.3 19.79 18.52 18.99L21.36 17.25C22.13 16.78 22.39 15.82 21.6 15.24L20.01 15.38Z" />
            </svg>
          </div>
          <div class="toolbar-icon hidden" id="btn-start-video" title="Start Video Call"
            onclick="window.app.startCall(null, true)">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M17 10.5V7C17 6.45 16.55 6 16 6H4C3.45 6 3 6.45 3 7V17C3 17.55 3.45 18 4 18H16C16.55 18 17 17.55 17 17V13.5L21 17.5V6.5L17 10.5Z" />
            </svg>
          </div>

          <div class="toolbar-icon" onclick="window.app.toggleMemberList()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M16 11C17.66 11 19 9.66 19 8C19 6.34 17.66 5 16 5C14.34 5 13 6.34 13 8C13 9.66 14.34 11 16 11ZM8 11C9.66 11 11 9.66 11 8C11 6.34 9.66 5 8 5C6.34 5 5 6.34 5 8C5 9.66 6.34 11 8 11ZM8 13C5.33 13 0 14.34 0 17V20H16V17C16 14.34 10.67 13 8 13ZM16 13C15.71 13 15.38 13.02 15.03 13.05C16.19 13.89 17 15.02 17 16.5V19H21V17C21 14.33 17.67 13 16 13Z" />
            </svg>
          </div>
        </div>
      </div>

      <!-- Content Area -->
      <div class="chat-area">
        <!-- Message List -->
        <div class="messages-wrapper" id="messages-container">
          <!-- Dynamic Messages -->
          <!-- <div class="message-group">
              <div class="message-avatar" style="background-image:url(...)"></div>
              <div class="message-content">
                 <div class="message-header">
                    <span class="message-username">Username</span>
                    <span class="message-timestamp">Today at 4:20 PM</span>
                 </div>
                 <div class="message-text">Hello world!</div>
              </div>
           </div> -->
        </div>

        <!-- Friends List View (Initially Hidden) -->
        <div class="friends-wrapper" id="friends-view">
          <div class="friends-header">
            <h3 style="color:var(--header-primary);">Friends</h3>
          </div>
          <div id="friends-list-container" style="flex:1;overflow-y:auto;">
            <!-- Dynamic content -->
          </div>
          <div style="padding-top:16px;">
            <button class="btn btn-primary" onclick="window.app.showAddFriendModal()">Add Friend</button>
          </div>
        </div>

        <!-- Input Area -->
        <div class="input-area" id="input-area">
          <div class="input-wrapper">
            <div class="input-upload-btn" onclick="document.getElementById('file-input').click()">+</div>
            <input id="file-input" type="file" style="display:none">
            <input class="input-field" id="message-input" placeholder="Message #general" autocomplete="off">
            <div class="input-icons">
              <!-- GIF, Sticker, Emoji placeholders -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Call Overlay -->
  <div class="call-overlay" id="call-overlay">
    <div class="video-grid" id="video-grid">
      <div class="video-container">
        <video id="remote-video" class="video-element" autoplay playsinline></video>
        <div class="call-placeholder" id="call-placeholder">
          <div class="user-avatar" style="width:80px;height:80px;font-size:32px;margin:auto;">U</div>
          <h2 style="margin-top:16px;">User</h2>
          <div style="color:var(--text-muted);">Calling...</div>
        </div>
      </div>
      <div class="video-container"
        style="position:absolute;bottom:100px;right:32px;width:240px;height:135px;z-index:10;box-shadow:0 0 10px rgba(0,0,0,0.5);">
        <video id="local-video" class="video-element" autoplay playsinline muted></video>
      </div>
    </div>
    <div class="call-controls">
      <button class="call-btn" id="btn-toggle-video" onclick="window.app.toggleVideo()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M17 10.5V7C17 6.45 16.55 6 16 6H4C3.45 6 3 6.45 3 7V17C3 17.55 3.45 18 4 18H16C16.55 18 17 17.55 17 17V13.5L21 17.5V6.5L17 10.5Z" />
        </svg>
      </button>
      <button class="call-btn" id="btn-toggle-mic" onclick="window.app.toggleMic()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
          <path
            d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
        </svg>
      </button>
      <button class="call-btn danger" onclick="window.app.endCall()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.7-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Incoming Call Modal -->
  <div class="modal-overlay" id="incoming-call-modal">
    <div class="modal-content" style="width:300px;text-align:center;padding:24px;">
      <div class="user-avatar" style="width:80px;height:80px;margin:0 auto 16px;font-size:32px;"
        id="incoming-call-avatar">U</div>
      <h3 id="incoming-call-name">Username</h3>
      <p style="color:var(--text-muted);margin-bottom:24px;">Incoming Call...</p>
      <div style="display:flex;justify-content:center;gap:32px;">
        <button class="call-btn danger" onclick="window.app.rejectCall()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.7-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z" />
          </svg>
        </button>
        <button class="call-btn" style="background-color:var(--green);" onclick="window.app.acceptCall()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M20.01 15.38C18.78 15.01 17.37 15.19 16.31 15.91L15.48 16.74C12.38 15.22 10.39 12.87 9.17 10.22L10.02 9.38C10.75 8.32 10.92 6.91 10.55 5.68L9.77 3.03C9.52 2.18 8.64 1.69 7.76 1.88L4.31 2.65C3.32 2.87 2.5 3.96 2.83 5.09C4.33 10.23 8.35 15.79 14.18 19.16C15.6 19.97 17.3 19.79 18.52 18.99L21.36 17.25C22.13 16.78 22.39 15.82 21.6 15.24L20.01 15.38Z" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Settings Modal (Reuse structure) -->
  <div class="modal-overlay" id="settings-modal" style="display:none;">
    <div class="modal-content" style="width:700px;height:80vh;flex-direction:row;">
      <div style="width:200px;background:var(--bg-secondary);padding:16px;">
        <div style="font-weight:700;color:var(--text-muted);font-size:12px;margin-bottom:8px;padding:0 10px;">USER
          SETTINGS</div>
        <div class="channel-item active" style="padding:6px 10px;">My Account</div>
        <div style="height:1px;background:var(--bg-modifier-active);margin:8px 0;"></div>
        <div class="channel-item" style="padding:6px 10px;color:var(--red);"
          onclick="document.getElementById('logout-btn').click()">Log Out</div>
      </div>
      <div style="flex:1;padding:40px;overflow-y:auto;">
        <h2 style="margin-bottom:24px;">My Account</h2>
        <div
          style="background:var(--bg-tertiary);border-radius:8px;padding:16px;display:flex;align-items:center;margin-bottom:24px;">
          <div class="user-avatar" id="settings-avatar-preview"
            style="width:80px;height:80px;font-size:32px;margin-right:24px;">U</div>
          <div style="flex:1;">
            <div id="settings-username" style="font-weight:700;font-size:20px;margin-bottom:4px;">Username</div>
            <div id="settings-email" style="color:var(--text-muted);">email@example.com</div>
          </div>
          <button class="btn btn-primary" onclick="window.app.editProfile()">Edit User Profile</button>
        </div>

        <div id="edit-profile-section" style="display:none;">
          <div style="margin-bottom:16px;">
            <label
              style="display:block;color:var(--text-muted);font-size:12px;font-weight:700;margin-bottom:8px;text-transform:uppercase;">Avatar
              URL</label>
            <input id="settings-avatar-input"
              style="width:100%;padding:10px;background:var(--input-bg);border:none;border-radius:3px;color:var(--text-normal);outline:none;">
          </div>
          <div style="display:flex;justify-content:flex-end;gap:8px;">
            <button class="btn btn-secondary" onclick="window.app.cancelEditProfile()">Cancel</button>
            <button class="btn btn-primary" onclick="window.app.saveProfile()">Save Changes</button>
          </div>
        </div>

        <button class="btn btn-primary"
          style="position:absolute;top:32px;right:32px;width:32px;height:32px;border-radius:50%;padding:0;display:flex;align-items:center;justify-content:center;"
          onclick="document.getElementById('settings-modal').style.display='none'">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Other Modals (Add Friend, Create Group, etc) would go here following similar structure -->
  <div class="modal-overlay" id="add-friend-modal" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 style="text-transform:uppercase;font-weight:700;">Add Friend</h3>
        <div style="color:var(--text-muted);">You can add a friend with their username.</div>
      </div>
      <div style="padding:0 24px;">
        <input id="add-friend-username" placeholder="Wumpus#0000"
          style="width:100%;padding:10px;background:var(--input-bg);border:none;border-radius:3px;color:var(--text-normal);outline:none;">
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary"
          onclick="document.getElementById('add-friend-modal').style.display='none'">Cancel</button>
        <button class="btn btn-primary" onclick="window.app.sendFriendRequest()">Send Friend Request</button>
      </div>
    </div>
  </div>

  <!-- Hidden inputs -->
  <input type="file" id="image-upload-input" style="display:none;" accept="image/*">

</body>

</html>